<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¹´ë©”ë¼ ì´¬ì˜ ë° í•„í„° ì„ íƒ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }

    /* ì¹´ë©”ë¼ ì˜ì—­ */
    #camera-container {
      position: relative;
      flex: 1;
      width: 100%;
      max-width: 600px;
      background: black;
      overflow: hidden;
    }

    video, #preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    #filter-overlay {
      position: absolute;
      inset: 0;
      background-image: url('filter1.png'); /* âœ… ì´ˆê¸° ê¸°ë³¸ í•„í„° */
      background-size: cover;
      background-position: center;
      opacity: 1;
      pointer-events: none;
      z-index: 1;
    }

    #preview {
      display: none;
      z-index: 2;
    }

    /* í•„í„° ì„¤ì • íŒ¨ë„ */
    #filter-controls {
      width: 100%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 0 80px; /* ë²„íŠ¼ ê²¹ì¹¨ ë°©ì§€ ê³µê°„ í™•ë³´ */
      z-index: 2;
    }

    #slider-container {
      width: 80%;
      max-width: 400px;
      text-align: center;
      margin-bottom: 10px;
    }

    input[type="range"] {
      width: 100%;
    }

    #filter-selector {
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .filter-option {
      width: 60px;
      height: 60px;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      transition: border 0.2s;
    }

    .filter-option.selected {
      border: 2px solid #1e90ff;
    }

    /* í•˜ë‹¨ ë²„íŠ¼ (í•­ìƒ í™”ë©´ ì•„ë˜ ê³ ì •) */
    #controls {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      z-index: 100;
      background: rgba(0, 0, 0, 0.5);
      padding: 12px 0;
      backdrop-filter: blur(5px);
    }

    button {
      background-color: #1e90ff;
      border: none;
      color: white;
      padding: 10px 16px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #555;
      color: #aaa;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

  <!-- ğŸ“¸ ì¹´ë©”ë¼ í‘œì‹œ -->
  <div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <div id="filter-overlay"></div>
    <img id="preview" alt="ì´¬ì˜ëœ ì´ë¯¸ì§€">
  </div>

  <!-- ğŸš í•„í„° ì„ íƒ ì˜ì—­ (ë²„íŠ¼ ì•„ë˜ë¡œ ë°€ë¦¬ì§€ ì•Šë„ë¡ ê³ ì • ë†’ì´ í™•ë³´) -->
  <div id="filter-controls">
    <div id="slider-container">
      <label for="opacitySlider">í•„í„° íˆ¬ëª…ë„: <span id="opacityValue">100%</span></label>
      <input type="range" id="opacitySlider" min="0" max="100" value="100">
    </div>

    <div id="filter-selector">
      <div class="filter-option selected" style="background-image:url('filter1.png')" data-src="filter1.png"></div>
      <div class="filter-option" style="background-image:url('filter2.png')" data-src="filter2.png"></div>
      <div class="filter-option" style="background-image:url('filter3.png')" data-src="filter3.png"></div>
    </div>
  </div>

  <canvas id="snapshot" style="display:none;"></canvas>

  <!-- ğŸ“± í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ -->
  <div id="controls">
    <button id="switchBtn">ğŸ”„ ì „/í›„ë©´ ì „í™˜</button>
    <button id="captureBtn">ğŸ“¸ ì´¬ì˜</button>
    <button id="retryBtn" style="display:none;">â†© ë‹¤ì‹œ</button>
    <button id="saveBtn" disabled>ğŸ’¾ ì €ì¥</button>
    <button id="shareBtn" disabled>ğŸ“¤ ê³µìœ </button>
  </div>

  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const preview = document.getElementById('preview');
    const filterOverlay = document.getElementById('filter-overlay');
    const captureBtn = document.getElementById('captureBtn');
    const retryBtn = document.getElementById('retryBtn');
    const saveBtn = document.getElementById('saveBtn');
    const shareBtn = document.getElementById('shareBtn');
    const switchBtn = document.getElementById('switchBtn');
    const opacitySlider = document.getElementById('opacitySlider');
    const opacityValue = document.getElementById('opacityValue');
    const filterSelector = document.getElementById('filter-selector');

    let stream;
    let currentFacingMode = 'environment'; // âœ… í›„ë©´ ê¸°ë³¸
    let currentOpacity = 1.0;
    let currentFilter = 'filter1.png'; // âœ… ê¸°ë³¸ í•„í„° 1 ì„ íƒ

    // ğŸ“· ì¹´ë©”ë¼ ì‹¤í–‰
    async function initCamera(facingMode = 'environment') {
      if (stream) stream.getTracks().forEach(t => t.stop());
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode }, audio: false });
        video.srcObject = stream;
        currentFacingMode = facingMode;
      } catch (err) {
        alert('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜: ' + err.message);
      }
    }

    initCamera(currentFacingMode);

    // ğŸ”„ ì „í›„ë©´ ì „í™˜
    switchBtn.addEventListener('click', () => {
      currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
      initCamera(currentFacingMode);
    });

    // ğŸš íˆ¬ëª…ë„ ì¡°ì ˆ
    opacitySlider.addEventListener('input', e => {
      const v = e.target.value;
      currentOpacity = v / 100;
      filterOverlay.style.opacity = currentOpacity;
      opacityValue.textContent = `${v}%`;
    });

    // ğŸ¨ í•„í„° ì„ íƒ ê¸°ëŠ¥
    filterSelector.addEventListener('click', e => {
      if (e.target.classList.contains('filter-option')) {
        document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
        e.target.classList.add('selected');
        currentFilter = e.target.dataset.src;
        filterOverlay.style.backgroundImage = `url('${currentFilter}')`;
      }
    });

    // ğŸ“¸ ì´¬ì˜ ê¸°ëŠ¥
    captureBtn.addEventListener('click', () => {
      const videoRatio = video.videoWidth / video.videoHeight;
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const filter = new Image();
      filter.src = currentFilter;
      filter.onload = () => {
        const imgRatio = filter.width / filter.height;
        let fw, fh, fx, fy;
        if (imgRatio > videoRatio) {
          fh = canvas.height;
          fw = filter.width * (fh / filter.height);
          fx = (canvas.width - fw) / 2;
          fy = 0;
        } else {
          fw = canvas.width;
          fh = filter.height * (fw / filter.width);
          fx = 0;
          fy = (canvas.height - fh) / 2;
        }
        ctx.globalAlpha = currentOpacity;
        ctx.drawImage(filter, fx, fy, fw, fh);
        ctx.globalAlpha = 1;

        preview.src = canvas.toDataURL('image/png');
        preview.style.display = 'block';
        captureBtn.style.display = 'none';
        retryBtn.style.display = 'inline-block';
        saveBtn.disabled = false;
        shareBtn.disabled = false;
      };
    });

    // ğŸ” ë‹¤ì‹œ ì´¬ì˜
    retryBtn.addEventListener('click', () => {
      preview.style.display = 'none';
      captureBtn.style.display = 'inline-block';
      retryBtn.style.display = 'none';
      saveBtn.disabled = true;
      shareBtn.disabled = true;
    });

    // ğŸ’¾ ì €ì¥
    saveBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'photo.png';
      link.href = preview.src;
      link.click();
    });

    // ğŸ“¤ ê³µìœ 
    shareBtn.addEventListener('click', async () => {
      if (navigator.share) {
        const response = await fetch(preview.src);
        const blob = await response.blob();
        const file = new File([blob], 'photo.png', { type: 'image/png' });
        await navigator.share({
          files: [file],
          title: 'ë‚˜ì˜ ì‚¬ì§„',
          text: 'ì´¬ì˜í•œ ì‚¬ì§„ì„ ê³µìœ í•©ë‹ˆë‹¤!',
        });
      } else {
        alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê³µìœ  ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>
