<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì¹´ë©”ë¼ ì´¬ì˜ ë° ì €ì¥/ê³µìœ </title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }
    #camera-container {
      position: relative;
      width: 90vw;
      max-width: 600px;
      aspect-ratio: 3/4;
      overflow: hidden;
      border-radius: 12px;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #filter-overlay {
      position: absolute;
      inset: 0;
      background-image: url('filter.png'); /* ì—¬ê¸°ì— í•„í„° PNG íŒŒì¼ ì´ë¦„ ì§€ì • */
      background-size: cover;
      background-position: center;
      opacity: 0.4; /* ë¶ˆíˆ¬ëª…ë„ ì¡°ì • */
      pointer-events: none;
    }
    #preview {
      display: none;
      width: 100%;
      max-width: 600px;
      border-radius: 12px;
      margin-top: 10px;
    }
    #controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }
    button {
      background-color: #1e90ff;
      border: none;
      color: white;
      padding: 10px 16px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }
    button:disabled {
      background-color: #555;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <div id="filter-overlay"></div>
  </div>

  <canvas id="snapshot" style="display:none;"></canvas>
  <img id="preview" alt="ì´¬ì˜ëœ ì´ë¯¸ì§€">

  <div id="controls">
    <button id="captureBtn">ğŸ“· ì´¬ì˜</button>
    <button id="saveBtn" disabled>ğŸ’¾ ì €ì¥</button>
    <button id="shareBtn" disabled>ğŸ“¤ ê³µìœ </button>
  </div>

  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const preview = document.getElementById('preview');
    const captureBtn = document.getElementById('captureBtn');
    const saveBtn = document.getElementById('saveBtn');
    const shareBtn = document.getElementById('shareBtn');

    // ì¹´ë©”ë¼ ì‹œì‘
    async function initCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch (err) {
        alert("ì¹´ë©”ë¼ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤: " + err.message);
      }
    }

    // ì‚¬ì§„ ì´¬ì˜
    captureBtn.addEventListener('click', () => {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      // PNG í•„í„°ë¥¼ ì˜¤ë²„ë ˆì´ë¡œ ì¶”ê°€
      const filter = new Image();
      filter.src = 'filter.png';
      filter.onload = () => {
        context.globalAlpha = 0.4; // ë¶ˆíˆ¬ëª…ë„ ì¡°ì •
        context.drawImage(filter, 0, 0, canvas.width, canvas.height);
        context.globalAlpha = 1.0;

        const dataUrl = canvas.toDataURL('image/png');
        preview.src = dataUrl;
        preview.style.display = 'block';
        saveBtn.disabled = false;
        shareBtn.disabled = false;
      };
    });

    // ì €ì¥ ê¸°ëŠ¥
    saveBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'photo.png';
      link.href = preview.src;
      link.click();
    });

    // ê³µìœ  ê¸°ëŠ¥ (ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ë˜ëŠ” ì§€ì› ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì‘ë™)
    shareBtn.addEventListener('click', async () => {
      if (navigator.share) {
        try {
          const response = await fetch(preview.src);
          const blob = await response.blob();
          const file = new File([blob], 'photo.png', { type: 'image/png' });
          await navigator.share({
            files: [file],
            title: 'ë‚˜ì˜ ì‚¬ì§„',
            text: 'ì´¬ì˜í•œ ì‚¬ì§„ì„ ê³µìœ í•©ë‹ˆë‹¤!',
          });
        } catch (error) {
          alert('ê³µìœ  ì‹¤íŒ¨: ' + error.message);
        }
      } else {
        alert('í•´ë‹¹ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê³µìœ  ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    });

    initCamera();
  </script>
</body>
</html>