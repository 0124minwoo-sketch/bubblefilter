<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¹´ë©”ë¼ ì´¬ì˜ ë° ì €ì¥/ê³µìœ </title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }

    #camera-container {
      position: relative;
      width: 90vw;
      max-width: 600px;
      aspect-ratio: 3/4;
      overflow: hidden;
      border-radius: 12px;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #filter-overlay {
      position: absolute;
      inset: 0;
      background-image: url('filter.png'); /* í•„í„° PNG íŒŒì¼ */
      background-size: cover;
      background-position: center;
      opacity: 1.0; /* ê¸°ë³¸ ë¶ˆíˆ¬ëª…ë„ 100% */
      pointer-events: none;
      transition: opacity 0.2s;
    }

    #preview {
      display: none;
      width: 100%;
      max-width: 600px;
      border-radius: 12px;
      margin-top: 10px;
    }

    #controls {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    button {
      background-color: #1e90ff;
      border: none;
      color: white;
      padding: 10px 16px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #555;
      cursor: not-allowed;
    }

    #slider-container {
      margin-top: 15px;
      width: 80%;
      max-width: 400px;
      text-align: center;
    }

    input[type="range"] {
      width: 100%;
    }

    label {
      display: block;
      font-size: 0.9em;
      color: #ddd;
      margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <div id="filter-overlay"></div>
  </div>

  <canvas id="snapshot" style="display:none;"></canvas>
  <img id="preview" alt="ì´¬ì˜ëœ ì´ë¯¸ì§€" />

  <div id="slider-container">
    <label for="opacitySlider">í•„í„° íˆ¬ëª…ë„ ì¡°ì ˆ: <span id="opacityValue">100%</span></label>
    <input type="range" id="opacitySlider" min="0" max="100" value="100" />
  </div>

  <div id="controls">
    <button id="switchBtn">ğŸ”„ ì¹´ë©”ë¼ ì „í™˜</button>
    <button id="captureBtn">ğŸ“¸ ì´¬ì˜</button>
    <button id="saveBtn" disabled>ğŸ’¾ ì €ì¥</button>
    <button id="shareBtn" disabled>ğŸ“¤ ê³µìœ </button>
  </div>

  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const preview = document.getElementById('preview');
    const switchBtn = document.getElementById('switchBtn');
    const captureBtn = document.getElementById('captureBtn');
    const saveBtn = document.getElementById('saveBtn');
    const shareBtn = document.getElementById('shareBtn');
    const filterOverlay = document.getElementById('filter-overlay');
    const opacitySlider = document.getElementById('opacitySlider');
    const opacityValue = document.getElementById('opacityValue');

    let currentFacingMode = 'user'; // ì „ë©´ ê¸°ë³¸
    let stream;
    let currentOpacity = 1.0; // ê¸°ë³¸ ë¶ˆíˆ¬ëª…ë„ 100%

    // ì¹´ë©”ë¼ ì´ˆê¸°í™”
    async function initCamera(facingMode = 'user') {
      if (stream) {
        const tracks = stream.getTracks();
        tracks.forEach(track => track.stop());
      }

      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: facingMode },
          audio: false
        });
        video.srcObject = stream;
        currentFacingMode = facingMode;
      } catch (err) {
        alert("ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜: " + err.message);
      }
    }

    initCamera(currentFacingMode);

    // ì¹´ë©”ë¼ ì „í™˜
    switchBtn.addEventListener('click', () => {
      currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
      initCamera(currentFacingMode);
    });

    // íˆ¬ëª…ë„ ìŠ¬ë¼ì´ë” ì¡°ì ˆ
    opacitySlider.addEventListener('input', e => {
      const value = e.target.value;
      const opacity = value / 100;
      currentOpacity = opacity;
      filterOverlay.style.opacity = opacity;
      opacityValue.textContent = `${value}%`;
    });

    // ì‚¬ì§„ ì´¬ì˜
    captureBtn.addEventListener('click', () => {
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvas.width, canvas.height);

      const filter = new Image();
      filter.src = 'filter.png';
      filter.onload = () => {
        context.globalAlpha = currentOpacity; // í˜„ì¬ íˆ¬ëª…ë„ ë°˜ì˜
        context.drawImage(filter, 0, 0, canvas.width, canvas.height);
        context.globalAlpha = 1.0;

        const dataUrl = canvas.toDataURL('image/png');
        preview.src = dataUrl;
        preview.style.display = 'block';
        saveBtn.disabled = false;
        shareBtn.disabled = false;
      };
    });

    // ì €ì¥ ê¸°ëŠ¥
    saveBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'photo.png';
      link.href = preview.src;
      link.click();
    });

    // ê³µìœ  ê¸°ëŠ¥
    shareBtn.addEventListener('click', async () => {
      if (navigator.share) {
        try {
          const response = await fetch(preview.src);
          const blob = await response.blob();
          const file = new File([blob], 'photo.png', { type: 'image/png' });
          await navigator.share({
            files: [file],
            title: 'ë‚˜ì˜ ì‚¬ì§„',
            text: 'ì´¬ì˜í•œ ì‚¬ì§„ì„ ê³µìœ í•©ë‹ˆë‹¤!',
          });
        } catch (error) {
          alert('ê³µìœ  ì‹¤íŒ¨: ' + error.message);
        }
      } else {
        alert('í•´ë‹¹ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê³µìœ  ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>
