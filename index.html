<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì¹´ë©”ë¼ í•„í„° í‘œì‹œ ì•ˆì •í™”</title>
<style>
  :root { --vh: 100%; }
  body {
    margin: 0;
    background-color: black;
    color: white;
    height: calc(var(--vh, 1vh) * 100);
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: hidden;
  }

  /* ì¹´ë©”ë¼ ì»¨í…Œì´ë„ˆ */
  #camera-container {
    position: relative;
    width: 100%;
    max-width: 600px;
    flex-grow: 1;
    background: black;
    overflow: hidden;
  }

  video, #preview, #filter-overlay {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* ë¹„ë””ì˜¤ ìµœìƒë‹¨ í‘œì‹œ */
  video { z-index: 0; }

  /* í•„í„° ì˜¤ë²„ë ˆì´ */
  #filter-overlay {
    z-index: 2;               /* âœ… ë¹„ë””ì˜¤ë³´ë‹¤ ìœ„ì— ìˆìŒ */
    pointer-events: none;
    opacity: 1;
    background-size: cover;
    background-position: center;
    transition: opacity 0.2s ease;
  }

  /* ë¯¸ë¦¬ë³´ê¸° */
  #preview { z-index: 3; display: none; }

  /* í•„í„° ì„¤ì • íŒ¨ë„ */
  #filter-panel {
    position: fixed;
    bottom: 0;
    width: 100%;
    max-width: 600px;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    color: white;
    display: none;
    z-index: 20;
    padding: 20px 0 30px;
    text-align: center;
  }

  #slider-container {
    width: 80%;
    max-width: 400px;
    margin: 0 auto 12px;
  }

  #filter-selector {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 8px;
  }

  .filter-option {
    width: 60px;
    height: 60px;
    border-radius: 6px;
    background-size: cover;
    background-position: center;
    border: 2px solid transparent;
    cursor: pointer;
    transition: border 0.2s;
  }

  .filter-option.selected { border-color: #1e90ff; }

  #closeFilterBtn {
    display: inline-block;
    background-color: #ff6347;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
  }

  /* ì¡°ì‘ ë²„íŠ¼ */
  #controls {
    position: fixed;
    bottom: 0;
    width: 100%;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px 0;
    z-index: 15;
    transition: opacity 0.3s, transform 0.3s;
  }

  #controls.hidden {
    opacity: 0;
    transform: translateY(100%);
    pointer-events: none;
  }

  button {
    background-color: #1e90ff;
    border: none;
    color: white;
    padding: 10px 14px;
    border-radius: 6px;
    cursor: pointer;
  }

  .disabled { background-color: #555; color: #aaa; }

  #toggleFilterBtn { background-color: #32cd32; }
</style>
</head>
<body>

  <div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <div id="filter-overlay"></div>
    <img id="preview" alt="ì´¬ì˜ ì‚¬ì§„ ë¯¸ë¦¬ë³´ê¸°" />
  </div>

  <!-- ğŸ¨ í•„í„° íŒ¨ë„ -->
  <div id="filter-panel">
    <div id="slider-container">
      <label for="opacitySlider">í•„í„° íˆ¬ëª…ë„: <span id="opacityValue">100%</span></label>
      <input type="range" id="opacitySlider" min="0" max="100" value="100" />
    </div>

    <div id="filter-selector">
      <div class="filter-option selected" style="background-image:url('filter1.png')" data-src="filter1.png"></div>
      <div class="filter-option" style="background-image:url('filter2.png')" data-src="filter2.png"></div>
      <div class="filter-option" style="background-image:url('filter3.png')" data-src="filter3.png"></div>
    </div>

    <button id="closeFilterBtn">âŒ í•„í„° ë‹«ê¸°</button>
  </div>

  <!-- ì¡°ì‘ ë²„íŠ¼ -->
  <div id="controls">
    <button id="switchBtn">ğŸ”„ ì „Â·í›„ë©´</button>
    <button id="captureBtn">ğŸ“¸ ì´¬ì˜</button>
    <button id="retryBtn" style="display:none;">â†© ë‹¤ì‹œ</button>
    <button id="toggleFilterBtn">ğŸ¨ í•„í„° ì—´ê¸°</button>
    <button id="saveBtn" disabled>ğŸ’¾ ì €ì¥</button>
    <button id="shareBtn" disabled>ğŸ“¤ ê³µìœ </button>
  </div>

  <canvas id="snapshot" style="display:none;"></canvas>

  <script>
    const video = document.getElementById('camera');
    const filterOverlay = document.getElementById('filter-overlay');
    const filterPanel = document.getElementById('filter-panel');
    const toggleFilterBtn = document.getElementById('toggleFilterBtn');
    const closeFilterBtn = document.getElementById('closeFilterBtn');
    const opacitySlider = document.getElementById('opacitySlider');
    const opacityValue = document.getElementById('opacityValue');
    const filterSelector = document.getElementById('filter-selector');
    const controls = document.getElementById('controls');

    let stream;
    let currentFilter = 'filter1.png';
    let currentOpacity = 1.0;
    let filterPanelOpen = false;
    let uiTimer, uiVisible = true;

    // âœ… ë·°í¬íŠ¸ ë†’ì´ ë³´ì •
    function setRealVH() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }
    window.addEventListener('resize', setRealVH);
    window.addEventListener('orientationchange', setRealVH);
    setRealVH();

    // âœ… í•„í„° ì´ˆê¸° ì ìš© â†’ ë¡œë“œ ë³´ì¥
    function setFilterImage(src) {
      const img = new Image();
      img.onload = () => {
        filterOverlay.style.backgroundImage = `url('${src}')`;
        filterOverlay.style.opacity = currentOpacity;
        console.log(`âœ… í•„í„° ì ìš©ë¨: ${src}`);
      };
      img.onerror = () => alert(`âš ï¸ í•„í„° ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${src}`);
      img.src = src;
    }

    // ğŸ“¸ ì¹´ë©”ë¼ ì‹œì‘
    async function initCamera(facingMode = 'environment') {
      if (stream) stream.getTracks().forEach(t => t.stop());
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode }, audio: false });
        video.srcObject = stream;
      } catch (err) {
        alert('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜: ' + err.message);
      }
    }
    initCamera();

    // ğŸ¨ í•„í„° ì—´ê¸°/ë‹«ê¸°
    toggleFilterBtn.addEventListener('click', openFilterPanel);
    closeFilterBtn.addEventListener('click', closeFilterPanel);

    function openFilterPanel() {
      filterPanel.style.display = 'block';
      controls.classList.add('hidden');
      filterPanelOpen = true;
    }

    function closeFilterPanel() {
      filterPanel.style.display = 'none';
      filterPanelOpen = false;
      controls.classList.remove('hidden');
      uiVisible = true;
      clearTimeout(uiTimer);
      uiTimer = setTimeout(hideControls, 3000);
    }

    // ğŸš íˆ¬ëª…ë„ ì¡°ì ˆ
    opacitySlider.addEventListener('input', e => {
      const v = e.target.value;
      currentOpacity = v / 100;
      opacityValue.textContent = v + '%';
      filterOverlay.style.opacity = currentOpacity;
    });

    // âœ… í•„í„° ì„ íƒ ì‹œ ë°”ë¡œ í‘œì‹œ
    filterSelector.addEventListener('click', e => {
      if (!e.target.classList.contains('filter-option')) return;
      document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
      e.target.classList.add('selected');
      currentFilter = e.target.dataset.src;
      setFilterImage(currentFilter);
    });

    // âœ… ì´ˆê¸° í•„í„° í‘œì‹œ ë³´ì¥
    window.addEventListener('load', () => {
      setFilterImage(currentFilter);
    });

    // ğŸ“± ìë™ UI ìˆ¨ê¹€
    function showControls() {
      if (uiVisible || filterPanelOpen) return;
      uiVisible = true;
      controls.classList.remove('hidden');
      clearTimeout(uiTimer);
      uiTimer = setTimeout(hideControls, 3000);
    }

    function hideControls() {
      if (filterPanelOpen) return;
      uiVisible = false;
      controls.classList.add('hidden');
    }

    uiTimer = setTimeout(hideControls, 3000);
    document.body.addEventListener('touchstart', showControls);
    document.body.addEventListener('click', showControls);
  </script>
</body>
</html>
