<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¹´ë©”ë¼ ì´¬ì˜ ë° í•„í„° ì„ íƒ</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
      overflow: hidden;
    }

    /* [1] ì¹´ë©”ë¼ ì˜ì—­ */
    #camera-container {
      position: relative;
      flex: 1;
      width: 100%;
      max-width: 600px;
      background: black;
      overflow: hidden;
    }

    video, #preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    #filter-overlay {
      position: absolute;
      inset: 0;
      background-image: url('filter1.png'); /* ê¸°ë³¸ í•„í„° */
      background-size: cover;
      background-position: center;
      opacity: 1;
      pointer-events: none;
      z-index: 1;
    }

    #preview {
      display: none;
      z-index: 2;
    }

    /* [2] í•„í„° ì¡°ì ˆ ì˜ì—­ (í† ê¸€ë¡œ ì—´ë¦¬ê³  ë‹«í˜) */
    #filter-panel {
      position: fixed;
      bottom: 70px;
      left: 0;
      width: 100%;
      max-width: 600px;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(6px);
      padding: 15px 0 20px;
      box-sizing: border-box;
      display: none; /* ì´ˆê¸°ì—ëŠ” ë‹«í˜ ìƒíƒœ */
      z-index: 9;
      transition: transform 0.3s ease;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    #slider-container {
      width: 80%;
      max-width: 400px;
      text-align: center;
      margin: 0 auto 12px;
    }

    input[type="range"] {
      width: 100%;
    }

    #filter-selector {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .filter-option {
      width: 60px;
      height: 60px;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      background-size: cover;
      background-position: center;
      transition: border 0.2s;
    }

    .filter-option.selected {
      border: 2px solid #1e90ff;
    }

    /* [3] í•˜ë‹¨ ì»¨íŠ¸ë¡¤ */
    #controls {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px 0 12px;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10;
      box-shadow: 0 -2px 6px rgba(0,0,0,0.5);
    }

    button {
      background-color: #1e90ff;
      border: none;
      color: white;
      padding: 10px 16px;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }

    button:disabled {
      background-color: #555;
      color: #aaa;
      cursor: not-allowed;
    }

    #toggleFilterBtn {
      background-color: #32cd32;
    }
  </style>
</head>
<body>

  <!-- ğŸ“¸ ì¹´ë©”ë¼ -->
  <div id="camera-container">
    <video id="camera" autoplay playsinline></video>
    <div id="filter-overlay"></div>
    <img id="preview" alt="ì´¬ì˜ëœ ì´ë¯¸ì§€" />
  </div>

  <!-- ğŸ¨ í•„í„° ì¡°ì ˆ íŒ¨ë„ (í† ê¸€ ê°€ëŠ¥) -->
  <div id="filter-panel">
    <div id="slider-container">
      <label for="opacitySlider">í•„í„° íˆ¬ëª…ë„: <span id="opacityValue">100%</span></label>
      <input type="range" id="opacitySlider" min="0" max="100" value="100" />
    </div>

    <div id="filter-selector">
      <div class="filter-option selected" style="background-image:url('filter1.png')" data-src="filter1.png"></div>
      <div class="filter-option" style="background-image:url('filter2.png')" data-src="filter2.png"></div>
      <div class="filter-option" style="background-image:url('filter3.png')" data-src="filter3.png"></div>
    </div>
  </div>

  <canvas id="snapshot" style="display:none;"></canvas>

  <!-- ğŸ› í•˜ë‹¨ ë²„íŠ¼ -->
  <div id="controls">
    <button id="switchBtn">ğŸ”„ ì „/í›„ë©´ ì „í™˜</button>
    <button id="captureBtn">ğŸ“¸ ì´¬ì˜</button>
    <button id="retryBtn" style="display:none;">â†© ë‹¤ì‹œ</button>
    <button id="toggleFilterBtn">ğŸ¨ í•„í„° ì„¤ì • ì—´ê¸°</button>
    <button id="saveBtn" disabled>ğŸ’¾ ì €ì¥</button>
    <button id="shareBtn" disabled>ğŸ“¤ ê³µìœ </button>
  </div>

  <script>
    const video = document.getElementById('camera');
    const canvas = document.getElementById('snapshot');
    const preview = document.getElementById('preview');
    const filterOverlay = document.getElementById('filter-overlay');
    const captureBtn = document.getElementById('captureBtn');
    const retryBtn = document.getElementById('retryBtn');
    const saveBtn = document.getElementById('saveBtn');
    const shareBtn = document.getElementById('shareBtn');
    const switchBtn = document.getElementById('switchBtn');
    const toggleFilterBtn = document.getElementById('toggleFilterBtn');
    const opacitySlider = document.getElementById('opacitySlider');
    const opacityValue = document.getElementById('opacityValue');
    const filterSelector = document.getElementById('filter-selector');
    const filterPanel = document.getElementById('filter-panel');

    let stream;
    let currentFacingMode = 'environment'; // ê¸°ë³¸: í›„ë©´
    let currentOpacity = 1.0;
    let currentFilter = 'filter1.png'; // ê¸°ë³¸ í•„í„°
    let filterPanelOpen = false; // í•„í„° íŒ¨ë„ ìƒíƒœ

    // ğŸ“· ì¹´ë©”ë¼ ì‹¤í–‰
    async function initCamera(facingMode = 'environment') {
      if (stream) stream.getTracks().forEach(t => t.stop());
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode }, audio: false });
        video.srcObject = stream;
        currentFacingMode = facingMode;
      } catch (err) {
        alert('ì¹´ë©”ë¼ ì ‘ê·¼ ì˜¤ë¥˜: ' + err.message);
      }
    }

    initCamera(currentFacingMode);

    // ğŸ”„ ì „í›„ë©´ ì „í™˜
    switchBtn.addEventListener('click', () => {
      currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
      initCamera(currentFacingMode);
    });

    // ğŸ¨ í•„í„° ì˜ì—­ ì—´ê¸°/ë‹«ê¸°
    toggleFilterBtn.addEventListener('click', () => {
      filterPanelOpen = !filterPanelOpen;
      filterPanel.style.display = filterPanelOpen ? 'block' : 'none';
      toggleFilterBtn.textContent = filterPanelOpen ? 'âŒ í•„í„° ì„¤ì • ë‹«ê¸°' : 'ğŸ¨ í•„í„° ì„¤ì • ì—´ê¸°';
      toggleFilterBtn.style.backgroundColor = filterPanelOpen ? '#ff6347' : '#32cd32';
    });

    // ğŸš íˆ¬ëª…ë„ ì¡°ì ˆ
    opacitySlider.addEventListener('input', e => {
      const v = e.target.value;
      currentOpacity = v / 100;
      filterOverlay.style.opacity = currentOpacity;
      opacityValue.textContent = `${v}%`;
    });

    // ğŸ¨ í•„í„° ì„ íƒ
    filterSelector.addEventListener('click', e => {
      if (e.target.classList.contains('filter-option')) {
        document.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('selected'));
        e.target.classList.add('selected');
        currentFilter = e.target.dataset.src;
        filterOverlay.style.backgroundImage = `url('${currentFilter}')`;
      }
    });

    // ğŸ“¸ ì´¬ì˜
    captureBtn.addEventListener('click', () => {
      const videoRatio = video.videoWidth / video.videoHeight;
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const filter = new Image();
      filter.src = currentFilter;
      filter.onload = () => {
        const imgRatio = filter.width / filter.height;
        let fw, fh, fx, fy;
        if (imgRatio > videoRatio) {
          fh = canvas.height;
          fw = filter.width * (fh / filter.height);
          fx = (canvas.width - fw) / 2;
          fy = 0;
        } else {
          fw = canvas.width;
          fh = filter.height * (fw / filter.width);
          fx = 0;
          fy = (canvas.height - fh) / 2;
        }
        ctx.globalAlpha = currentOpacity;
        ctx.drawImage(filter, fx, fy, fw, fh);
        ctx.globalAlpha = 1;

        preview.src = canvas.toDataURL('image/png');
        preview.style.display = 'block';
        captureBtn.style.display = 'none';
        retryBtn.style.display = 'inline-block';
        saveBtn.disabled = false;
        shareBtn.disabled = false;
      };
    });

    // ğŸ” ë‹¤ì‹œ ì´¬ì˜
    retryBtn.addEventListener('click', () => {
      preview.style.display = 'none';
      captureBtn.style.display = 'inline-block';
      retryBtn.style.display = 'none';
      saveBtn.disabled = true;
      shareBtn.disabled = true;
    });

    // ğŸ’¾ ì €ì¥
    saveBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'photo.png';
      link.href = preview.src;
      link.click();
    });

    // ğŸ“¤ ê³µìœ 
    shareBtn.addEventListener('click', async () => {
      if (navigator.share) {
        const response = await fetch(preview.src);
        const blob = await response.blob();
        const file = new File([blob], 'photo.png', { type: 'image/png' });
        await navigator.share({
          files: [file],
          title: 'ë‚˜ì˜ ì‚¬ì§„',
          text: 'ì´¬ì˜í•œ ì‚¬ì§„ì„ ê³µìœ í•©ë‹ˆë‹¤!',
        });
      } else {
        alert('ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê³µìœ  ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    });
  </script>
</body>
</html>
